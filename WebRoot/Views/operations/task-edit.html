
<div class="modal fade" id="edit" tabindex="-1" role="dialog"
	aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="color-line"></div>
			<div class="modal-header ">
				<button type="button" class="close" data-dismiss="modal"
					aria-hidden="true">&times;</button>
			</div>
			<div class="modal-body pad-0">
				<form action="#" id="editForm" onSubmit="return false">
					<div class="row">
						<div class="col-md-12">
							<h3 class="w-title">工作联系单</h3>
						</div>
					</div>
					<div class="row">
					<div class="col-md-12" ng-show="false">
					<input name="taskId" ng-model="editData.taskId">
                    <input name="check_person"  ng-model="editData.check_person">
					</div>

						<div class="col-md-12">
							<table class="w-table">
							<tr>
                                    <td width="130px" class="w-tag">项目名称</td>
                                    <td colspan="3">成都市应急指挥调度无线通信网</td>
                                </tr>
								<tr>
									<td width="130px" class="w-tag">事&nbsp;&nbsp;&nbsp;&nbsp;由</td>
									<td colspan="3"><input type="text" class="form-input"
										name="reason" required="required" ng-model="editData.reason"></td>
								</tr>
								<tr>
									<td width="130px" class="w-tag">类&nbsp;&nbsp;&nbsp;&nbsp;型 </td>
									<td colspan="1">
									<select name="type" class="form-select" ng-model="editData.type">
									<option value="通信保障">通信保障</option>
									<option value="应急处置演练">应急处置演练</option>
									<option value="服务抽检">服务抽检</option>
									<option value="网络优化与整改">网络优化与整改</option>
									<option value="故障处理">故障处理</option>
									<option value="频率干扰排查">频率干扰排查</option>
									<option value="信号覆盖测试">信号覆盖测试</option>
									<option value="支持与配合工作">支持与配合工作</option>
									<option value="其他事项" selected="selected">其他事项</option>
									</select>
									</td>
									 <td width="130px" class="w-tag">级&nbsp;&nbsp;&nbsp;&nbsp;别</td>
                                    <td colspan="1">
                                       <select name="level" class="form-select" ng-select="editData.level">
                                                <option value="一般" selected="selected">一般</option>
                                                <option value="重大">重大</option>
                                                 <option value="特别重大">特别重大</option>
                                            </select>
                                    </td>
								</tr>
								<tr>
                                   
                                    
                                </tr>
								<tr>
									<td width="130px" class="w-tag">发文单位</td>
									<td colspan="3">
									<input type="text" class="form-input"
                                        name="sendUnit" required="required" ng-model="editData.sendUnit" readonly="readonly">
										
										
									</td>
								</tr>
								<tr>
									<td width="130px" class="w-tag">收文单位</td>
									<td colspan="3">
									   <select name="recvUnit" class="form-select" ng-model="editData.recvUnit">
                                                <option value="成都市软件产业发展中心（成都信息化技术应用发展中心）">成都市软件产业发展中心（成都信息化技术应用发展中心）</option>
                                                <option value="成都亚光电子股份有限公司" selected="selected">成都亚光电子股份有限公司</option>
                                            </select>
									</td>
									
								</tr>
								<tr>
									<td width="130px" class="w-tag">抄&nbsp;&nbsp;&nbsp;&nbsp;送</td>
									<td colspan="3"><input type="text" class="form-input"
										name="copyUnit" ng-model="editData.copyUnit"></td>
								</tr>
								<tr>
									<td width="130px" class="w-tag">时&nbsp;&nbsp;&nbsp;&nbsp;间</td>
									<td><input type="text" class="form-input" name="time"
									onfocus="WdatePicker({dateFmt:'yyyy-MM-dd DD',firstDayOfWeek:1,isShowWeek:true})"
														placeholder="时间" required="required" value="" ng-model="editData.time">
									</td>
									<td width="130px" class="w-tag">编&nbsp;&nbsp;&nbsp;&nbsp;号</td>
									<td><input type="text" class="form-input" name="code" readonly="readonly" required="required" ng-model="editData.code">
									</td>
								</tr>
<!-- 联系人：张振华  联系电话：15108275800 负责人：谭  巍  联系电话：1309060858 -->
								<tr style="height:140px; text-align: left;">
									<td colspan="4">
									<textarea class="form-input" name="content" rows="10" id="content"></textarea>
									</td>
								</tr>
								<tr>
                                    <td width="130px"><a href="#" ng-click="showUpdateFileWin()">新增附件</a> </td>
                                     
                                   <td colspan="3">
                                   <div class="file-div">
                                   <input  class="form-control" type="file" id="pathName2" name="pathName2" onchange="upFile2()" ng-show="false"/>
                                   <ul>
                                    <li ng-repeat="x in editData.files">
                                    <a href="#" ng-click="download(x.filePath)">{{x.fileName}}</a>
                                    <a href="#" ng-show="false" class="path">{{x.filePath}}</a>
                                    &nbsp;&nbsp;
                                    <a href="#" ng-click="download(x.filePath)">| 下载</a> 
                                    &nbsp;&nbsp;<a href="#" ng-click="previewDoc(x.filePath)"> | 预览</a>
                                    &nbsp;&nbsp;<a href="#" ng-click="delTaskFile(x.id)" class='del-file'> | 删除</a>
                                    </li>
                                   
                                   
                                   </ul>
                                   </div>
                                   
                                   
                                   
                                    </td>
                                  
                                    </tr>
                                    
                                    <tr>
                                    <td>拟制</td><td>{{detailData.userName}}</td>
                                    <td>审核</td><td>{{detailData.checkUserName}}</td>
                                </tr>
                               <!--  <tr>
                                <input type="hidden" name="fileName" value="" /> 
                        <input type="hidden" name="filePath" value="" /> 
                        <input type="hidden" name="result" value="" />
                                </tr> -->

							</table>

						</div>
					</div>



				</form>

			</div>
			<div class="modal-footer">
				<button type="button" ng-disabled="form.$invalid"
					class="btn btn-success btn-sm" id="update_btn">
					<i class="fa fa-plus"></i>&nbsp;修改
				</button>
				<button type="button" class="btn btn-danger btn-sm"
					data-dismiss="modal">
					<i class="fa fa-remove"></i>&nbsp;关闭
				</button>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
	$("#update_btn").click(function() {
		$('#editForm').submit();

	});
	$(document).on("click",".del-file",function(){
		$(this).parent().remove();
	})
	var faIcon = {
		valid : 'fa fa-check-circle fa-lg text-success',
		invalid : 'fa fa-times-circle fa-lg',
		validating : 'fa fa-refresh'
	};
	$('#editForm').bootstrapValidator({
		excluded : [ ':disabled' ],
		/* feedbackIcons: faIcon, */
		fields : {

		}
	}).on('success.form.bv', function(e, data) {
		e.preventDefault();
		$("#edit_btn").button('loading');
		xh.edit();
	});
function upFile2(){
        
        var name=$("input[name=pathName2]").val();
        var mm=$("input[name=pathName2]").get(0).files;
        var size=0;
        if (mm[0].size > 1024 * 1024) {
            size = (Math.round(mm[0].size / (1024 * 1024))).toString()
                    + 'MB';
        } else {
            size = (Math.round(mm[0].size / 1024)).toString() + 'KB';
        }
        
        var str="";
        str+="<li>";
        str+="<span>"+mm[0].name+"</span>";
        str+="<span class='path' style='display:none;' id='filepath"+fileNum+"'></span>";
        str+="<span>("+size+")</span>"
        str+="<span style='color:red;margin-left:20px' id='upresult"+fileNum+"'></span>"
        str+="<span style='color:blue;margin-left:20px;cursor:pointer' class='del-file' >删除</span>"
        str+="</li>"
        $(".file-div ul").append(str);
        upload2("upresult"+fileNum,"filepath"+fileNum);
        fileNum++;
    }
    function upload2(r,p){
         if ($('#pathName2').val() == "") {
            alert("请选择需要上传的文件！");
            return false;
        } 
        xh.maskShow("正在上传文件，请耐心等待");
        $.ajaxFileUpload({
            url : '../../uploadFile/upload2', //用于文件上传的服务器端请求地址
            secureuri : false, //是否需要安全协议，一般设置为false
            fileElementId : 'pathName2', //文件上传域的ID
            dataType : 'json', // 返回值类型 一般设置为json
            type : 'POST',
            success : function(data, status) //服务器成功响应处理函数
            {
                xh.maskHide();
                if (data.success) {
                    $("#"+r).html("文件上传成功");
                    $("#"+p).html(data.filePath);
                    fileNum=0;
                    
                    toastr.success("文件上传成功", '提示');
                } else {
                    toastr.error("文件上传失败", '提示');
                    $("#"+r).html("文件上传失败");
                }

            },
            error : function(data, status, e)//服务器响应失败处理函数
            {
                alert(e);
                xh.maskHide();
            }
        });
    }
	
</script>